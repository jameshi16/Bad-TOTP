#ifndef TEST_HMAC_SHA1
#define TEST_HMAC_SHA1

#include "../sha1.h"
#include "../hmac.h"

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int test_hmac_sha1_helper(const void* msg, size_t size, const void* key, size_t keySize, const char* expected) {
  printf("Message: %s\n", (const char*) msg);
  printf("Expected: %s\n", expected);

  uint8_t* data = hmac(msg, size, key, keySize, (void* (*) (const void*, size_t)) method_two, 64, 20);
  char result[40];
  for (int i = 0; i < 20; i++) {
    sprintf(result + i * 2, "%02x", data[i]);
  }
  printf("Actual:   %s\n", result);

  int compareResult = strcmp(result, expected);
  compareResult ? printf("Failed\n\n") : printf("Passed\n\n");
  free(data);
  return compareResult;
}

int test_hmac_sha1() {
  const char key1[] = "Jefe";
  const char key2[] = {
    0x0b, 0x0b, 0x0b, 0x0b,
    0x0b, 0x0b, 0x0b, 0x0b,
    0x0b, 0x0b, 0x0b, 0x0b,
    0x0b, 0x0b, 0x0b, 0x0b,
    0x0b, 0x0b, 0x0b, 0x0b
  };
  const char key3[] = {
    0x0c, 0x0c, 0x0c, 0x0c,
    0x0c, 0x0c, 0x0c, 0x0c,
    0x0c, 0x0c, 0x0c, 0x0c,
    0x0c, 0x0c, 0x0c, 0x0c,
    0x0c, 0x0c, 0x0c, 0x0c
  };
  const uint8_t key4[] = {
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa, 0xaa, 0xaa, 0xaa, 0xaa,
    0xaa
  };
  const char message1[] = "what do ya want for nothing?";
  const char message2[] = "Hi There";
  const char message3[] = "Test With Truncation";
  const char message4[] = "Test Using Larger Than Block-Size Key - Hash Key First";

  const char result1[] = "effcdf6ae5eb2fa2d27416d5f184df9c259a7c79";
  const char result2[] = "b617318655057264e28bc0b6fb378c8ef146be00";
  const char result3[] = "4c1a03424b55e07fe7f27be1d58bb9324a9a5a04";
  const char result4[] = "90d0dace1c1bdc957339307803160335bde6df2b";

  int result = 0;

  result += test_hmac_sha1_helper(message1, sizeof(message1) - 1, key1, sizeof(key1) - 1, result1) ? 1 : 0;
  result += test_hmac_sha1_helper(message2, sizeof(message2) - 1, key2, sizeof(key2), result2) ? 1 : 0;
  result += test_hmac_sha1_helper(message3, sizeof(message3) - 1, key3, sizeof(key3), result3) ? 1 : 0;
  result += test_hmac_sha1_helper(message4, sizeof(message4) - 1, key4, sizeof(key4), result4) ? 1 : 0;

  return result;
}

#endif
